# 수정해보자 -> 수정완료: 
import copy
import datetime
import sys
import time
from collections import deque
from itertools import combinations, permutations

def Input_Data():
	readl = sys.stdin.readline
	R, C = map(int,readl().split())
	map_city = [readl().strip() for _ in range(R)]
	return R, C, map_city

R, C, map_city = Input_Data()


# 여기서부터 작성
start_time = time.time()

point_pos = dict()
dir = [[1,0],[-1,0],[0,1],[0,-1]]

# S 및 숫자 위치 딕셔너리에 저장
for i in range(R):
	for j in range(C):
		if map_city[i][j] == 'S':
			point_pos['S'] = [i, j]
		if map_city[i][j] != '.' and map_city[i][j] != '*':
			point_pos[map_city[i][j]] = [i, j]
# print(point_pos)

pointSet = set(list(point_pos))
pointList = list(point_pos)		# iterable 쓰려고 만들었었는데 그냥 pointSet 쓰면 안되나?

# 두 점간 위치 간 최단거리 BFS로 구현
# S:[sy, sx], E = [ey, ex]
def bfs(S, E):
	sy, sx = S[0], S[1]
	ey, ex = E[0], E[1]
	# dist = [[1000]*C for _ in range(R)]			# 45번 거리 구할 때 마다 초기화됨, 수정하여 10번만 초기화 될 수 있도록 위치 이동하여 최적화 필요 -> 이동 완료
	dist[sy][sx] = 0
	Q = deque()
	Q.append([sy, sx])
	while Q:
		y, x = Q.popleft()
		for dy, dx in dir:
			ny, nx = y+dy, x+dx
			if 0<=ny<R and 0<=nx<C and map_city[ny][nx] != '*' and dist[ny][nx] > dist[y][x]+1:
				dist[ny][nx] = dist[y][x]+1
				Q.append([ny,nx])
	return dist[ey][ex]
# test_bfs = bfs([0,1], [3,0])

combTwoPoint = combinations(pointList, 2)	# 그냥 쓴거랑 set, list로 변환해서 쓴거랑 시간차이? 0.84 초 -> 0.21초
combTwoPoint_dist = dict.fromkeys(combTwoPoint, 0)
# print(combTwoPoint_dist)

# 두 포인트 간 최단거리 미리 구해놓기
distance_dict_make_time = time.time()

# for comb in combTwoPoint:
# 	pos1, pos2 = comb
# 	start = point_pos[pos1]
# 	end = point_pos[pos2]
# 	dis = bfs(start, end)
# 	combTwoPoint_dist[comb] = dis							# combination 반환값은 튜플로
# print(combTwoPoint_dist)	
# print("두 포인트 간 거리 찾는 코드 실행시간: ", time.time() - distance_dict_make_time, "초")		#맥 0.84초, 윈도우 2초 -> combTwoPoint 변환 없이 사용시 4.6e-05 초

# 두 포인트 간 최단거리 구하는 더 좋은 방법은? 현재 bfs 실행 시 매번(10C2) 새로운 dist 배열을 만들기에 비 효율적, 시작점 하나에 대해 나머지 9번 거리 구할 시 총 10번만 새로 만들면 됨
# 시험중 아래와 같이 만들다 실패 -> 조건 추가로 수정 완료
for pos1 in pointList:
	dist = [[1000]*C for _ in range(R)]		# 각 시작 포인트에서만 dist배열 초기화 해주면 됨
	for pos2 in pointList:
		if pos1 != pos2:
			start = point_pos[pos1]
			end = point_pos[pos2]
			dis = bfs(start, end)
			if (pos1, pos2) in combTwoPoint_dist or (pos2, pos1) in combTwoPoint_dist:		# 조건 추가하여 정상동작 확인, dict의 키가 튜플이므로 넣어줄 때 이렇게
				combTwoPoint_dist[(pos1, pos2)] = dis
print("두 포인트 간 거리 찾는 코드 실행시간: ", time.time() - distance_dict_make_time, "초")
print(combTwoPoint_dist)

copyPointList = copy.deepcopy(pointList)
copyPointList.remove('S')			# S를 제거하는 더 좋은 방법은 없나? 요소가 10개 이내라 remove 써도 괜춘
P = (permutations(copyPointList,len(copyPointList)))		# 리스트로 반환 하고 안하고 시간차? 확인 시 동일, 그래도 리스트로 변환하지 말자

min_dis = 1000		# 100*100에서 모든 포인트 순회 후 돌아올 때 1000 안넘을 것으로 보임, 더 작게 하면? 
# P는 최대 9!의 개수를 가질 수 있음, 모든 경우의 수에 대해 하나씩 확인, 가지치기 할 수 있는 방법은?
for p in P:
	tmp_dis = 0
	s = 'S'
	for point in p:
		e = point
		if (s, e) in combTwoPoint_dist.keys() or (e,s) in combTwoPoint_dist.keys():
			tmp_dis += combTwoPoint_dist[(s,e)]
		if tmp_dis > min_dis:		# 중간 가지치기
			break
		s = point
	e = 'S'
	if (s, e) in combTwoPoint_dist.keys() or (e, s) in combTwoPoint_dist.keys():
		tmp_dis += combTwoPoint_dist[(s,e)]            
	min_dis = min(min_dis, tmp_dis)
print(min_dis)		

print("time :", time.time() - start_time, "초")  # 현재시각 - 시작시간 = 실행 시간, 100*100 행렬 기준 맥에서 1.2 초, window에서 초


# 출력하는 부분
# print(sol)

# 입력 기억 안남 아래는 기억 의존:
# 5 5
# .S*.1
# ..*2.
# 3....
# .....
# ...4.

# 출력(위 입력에 맞는 답 아님):
# 18 


# 위 제출 답안 수정:



# 테스트케이스 제작:
# 3 3
# S.1
# **.
# 2..
# 4 4
# S...
# *1*3
# ..5.
# 4...


# 100 100
# ..........................................................................................S.........
# ...8.......................................................*****************************************
# ..............................1...................................................................*.
# ..................................................................................................*2
# ....*...............................................................................................
# ..................................................**********........................................
# .......5..........................................*3*...............................................
# ....................................................................................................
# ................*..................................................................................*
# ...............6*...................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# .................9..................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ......................................................4.............................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
# .....7..............................................................................................
# ....................................................................................................
# ....................................................................................................
# ....................................................................................................
